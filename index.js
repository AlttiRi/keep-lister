var e=Object.defineProperty,__publicField=(t,n,a)=>(((t,n,a)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a})(t,"symbol"!=typeof n?n+"":n,a),a);import{r as t,c as n,i as a,t as s,w as o,a as r,b as i,m as l,u as c,o as u,d,e as p,f,g as h,h as v,j as m,n as y,k as g,l as b,F as w,p as S,q as k,s as z,v as D,x as T,y as x,z as E,A as M,B as _,C as j,T as C,D as $,E as I,G as P,H as F,I as L}from"./vendor.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))processPreload(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&processPreload(e)})).observe(document,{childList:!0,subtree:!0})}function processPreload(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const B=globalThis.setImmediate||function(){const{port1:e,port2:t}=new MessageChannel,n=[];return e.onmessage=function(){n.shift()()},function(e){t.postMessage(null),n.push(e)}}();function sleep(e){return new Promise(void 0===e?e=>B(e):t=>setTimeout(t,e))}const R=["mp4","webm","mkv","avi"];const W=["png","jpg","jpeg","gif","tiff","webp"];function dateToDayDateString(e,t=!0){const n=new Date(e);function pad2(e){return e.toString().padStart(2,"0")}"Invalid Date"===n.toString()&&console.warn("Invalid Date value: ",e);const a=t?"UTC":"",s=n[`get${a}FullYear`](),o=n[`get${a}Month`]()+1,r=n[`get${a}Date`]();return s+"."+pad2(o)+"."+pad2(r)}function dateToDayDateTimeString(e,t=!0){const n=new Date(e);function pad2(e){return e.toString().padStart(2,"0")}const a=t?"UTC":"",s=n[`get${a}Hours`](),o=n[`get${a}Minutes`](),r=n[`get${a}Seconds`](),i=pad2(s)+":"+pad2(o)+":"+pad2(r);return dateToDayDateString(n,t)+" "+i+(t?"Z":"")}async function*iterateAsyncDataSource(e){if(e instanceof Response&&(e=e.body),e instanceof ReadableStream)yield*async function*(e){const t=e.getReader();for(;;){const{done:e,value:n}=await t.read();if(e)break;yield n}}(e);else if(e instanceof Blob)for(const t of function*(e,t=2097152){let n=0;for(;;){const a=e.slice(n,n+t);if(!a.size)break;yield read(a),n+=t}async function read(e){return new Uint8Array(await e.arrayBuffer())}}(e))yield await t}function bytesToSize(e,t=2){if(0===e)return"0 B";t=t<0?0:t;const n=Math.floor(Math.log(e)/Math.log(1024));return Number.parseFloat((e/Math.pow(1024,n)).toFixed(t))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][n]}function bytesToSizeWinLike(e){if(e<1024)return e+" B";let t=Math.floor(Math.log(e)/Math.log(1024)),n=e/Math.pow(1024,t);return n>=1e3&&(t++,n/=1024),function(e){let t;e<10?t=Math.trunc(100*e)/100:e<100?t=Math.trunc(10*e)/10:e<1e3&&(t=Math.trunc(e));if(e<.1)return t.toPrecision(1);if(e<1)return t.toPrecision(2);return t.toPrecision(3)}(n)+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]}const A=t(!0),O=t("name"),N=t({name:!1,size:!1,mtime:!1}),U=n((()=>N.value[O.value]));const{compare:H}=new Intl.Collator(void 0,{numeric:!0,sensitivity:"accent"});function comparator(e,t){const n=U.value?-1:1;if(A.value){if("name"===O.value)return H(e.name,t.name)*n;if("size"===O.value)return(e.size-t.size)*n;if("mtime"===O.value)return(e.mtime-t.mtime)*n}return 0}const Z=n((()=>(ue.value,[...fe.value.folders.sort(comparator),...fe.value.files.sort(comparator),...fe.value.symlinks.sort(comparator),...fe.value.fifos.sort(comparator),...fe.value.charDevs.sort(comparator),...fe.value.blockDevs.sort(comparator),...fe.value.sockets.sort(comparator)]))),G=t(50),J=n((()=>ae.value.length?se.value:Z.value)),K=n((()=>J.value.slice(0,G.value))),q=n((()=>se.value.length>G.value?se.value.length:J.value.length)),Y=t(null),V=t("");function addMessage(e){V.value=e}function appendMessage(e){V.value+=e}function debugMessageFromEntry(e){var t;if(console.log(a(e)?"Proxy:":"Raw:",s(e)),e.hasErrors)V.value="";else{const n='"'+e.name.slice(0,20)+(e.name.length<20?"":"...")+'"';let a="";a+=`mtime "${dateToDayDateTimeString(e.mtime,!1)}"`,a+=` ‚Äî  btime "${dateToDayDateTimeString(null!=(t=e.btime)?t:0,!1)}"`,a+=` ‚Äî ${n} ‚Äî ${e.size} (${bytesToSizeWinLike(e.size)})`,V.value=a}}const Q=["folder","file","symlink","fifo","charDev","blockDev","socket"];class SimpleEntry{constructor(e,t,n){this.name=e.name,this.parent=t,this.type=e.type,e.size&&(this._size=e.size),e.mtime&&(this.mtime=e.mtime),e.btime&&(this.btime=e.btime),e.errors&&(this.errors=e.errors.map((e=>n.get(e)))),e.pathTo&&(this.pathTo=e.pathTo),e.content&&(this.content=e.content)}addChild(e){this.children||(this.children=[]),this.children.push(e),this.increaseContentSize(e.size)}addHardlinks(e,t){this.hardlinks=e,this.hardlinksTotal=t}increaseContentSize(e){e&&(this._contentSize||(this._contentSize=0),this._contentSize+=e,this.parent&&e&&this.parent.increaseContentSize(e))}get size(){return"folder"===this.type?this._contentSize||0:this._size||0}get folders(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"folder"===e.type)))||[]}get files(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"file"===e.type)))||[]}get symlinks(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"symlink"===e.type)))||[]}get fifos(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"fifo"===e.type)))||[]}get charDevs(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"charDev"===e.type)))||[]}get blockDevs(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"blockDev"===e.type)))||[]}get sockets(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"socket"===e.type)))||[]}get isEmpty(){var e;return!Boolean(null==(e=this.children)?void 0:e.length)}get hasErrors(){var e;return Boolean(null==(e=this.errors)?void 0:e.length)}get root(){return this.parent?this.parent.root:this}get path(){return this.parent?[...this.parent.path,this]:[this]}}class EntryStreamParser{constructor(){this.rootId=0,this.map=new Map,this.hidMap=new Map}setMeta(e){this.meta=e;const t=e.errorsMap;t&&(this.errorsIDMap=new Map(Object.entries(t).map((([e,t])=>{const[n,a,s]=e.split(":");return[t,{code:n,syscall:a,errno:Number(s)}]}))))}parse(e){var t;let n=!1;for(const a of e){const e=null!=(t=this.map.get(a.pid))?t:null,s=new SimpleEntry(a,e,this.errorsIDMap);if("folder"===a.type&&this.map.set(a.id,s),null==e||e.addChild(s),a.hid){const e=this.hidMap.get(a.hid)||[];this.hidMap.set(a.hid,[...e,s])}a.pid===this.rootId&&(n=!0)}return{root:this.map.get(this.rootId),rootUpdated:n}}processHIDMapAsync(){this.hidMap.size&&(console.log("[hidMap]:",this.hidMap),console.time("hidMap"),async function(e){let t=0,n=0;for(const[a,s]of e.entries()){if(!(t++%1e3)){const e=Date.now();e-n>15&&(n=e,await sleep())}const e=Number(a.split(":")[1]);s.forEach((t=>{t.addHardlinks(s,e)}))}}(this.hidMap).then((()=>console.timeEnd("hidMap"))))}}const X=new SimpleEntry({type:"folder",name:"",pid:null},null),ee=t(!1),te=t(!1),ne=t(!1),ae=t("");function clearSearch(){ae.value=""}const se=t([]);function setSearchResult(e){const t=s(e);se.value=t,G.value=50,function(e){globalThis.search=e,console.log("globalThis.search:",e),Object.defineProperty(globalThis.search,"download",{get(){console.log("download")}}),Object.defineProperty(globalThis.search,"names",{get:()=>globalThis.search.map((e=>e.name))}),Object.defineProperty(globalThis.search,"namelist",{get:()=>globalThis.search.map((e=>e.name)).join("\n")})}(t)}o([O,U],(()=>{se.value.length&&(console.time("sort searchResult"),se.value=se.value.sort(comparator),console.timeEnd("sort searchResult"))}));let resolve=()=>{},oe=Promise.resolve(!0);r((()=>{ee.value?(resolve(!1),oe=new Promise((e=>resolve=e))):resolve(!0)}));const re=function(e,t=50){let n;return function(){n&&clearTimeout(n),n=setTimeout((()=>{e.apply(this,arguments),n=null}),t)}}(performSearch,300);async function performSearch(){if(!1===await oe)return;const e=fe.value,t=ae.value,n=i(e)?s(e):e,a=performance.now();te.value=!0;const o=await async function(e,t){var n,a,s,o;if(t.startsWith("//"))return justSearch(t.slice(2));if(["https://","http://"].some((e=>t.startsWith(e)))){const e=new URL(t);let s;if("www.youtube.com"===e.hostname&&"/watch"===e.pathname)s=e.searchParams.get("v");else{const t=e.pathname.length>1&&e.pathname.endsWith("/"),o=null==(n=(t?e.pathname.slice(0,-1):e.pathname).match(/[^\/]+$/))?void 0:n[0];if(!o)return[];const{name:r,ext:i}=(null==(a=o.match(/(?<name>.+)(\.(?<ext>.+))$/))?void 0:a.groups)||{name:o};s=r+(t&&i?`.${i}`:"")}const o=await justSearch(s);return Object.defineProperty(o,"customSearchText",{value:s}),o}const r="\\/s(ize)?(?<defaultPrefix>b|k|m|g|t)?[:\\/]";if(t.match(new RegExp(r))){const n=new RegExp(r+"(?<extra1>(?<caret>\\^)|(?<dollar>\\$)|(?<percent>%))?"+"((?<sizeString1>\\s*\\d[\\d\\s\\,]*)((?<dotDecimal1>\\.(?<decimal1>\\d+)?))?(?<prefix1>b|k|m|g|t)?(?<exclamations>!+)?)"+`(?<range>${"(?<extra2>(?<plus>\\+)|(?<minus>\\-)|(?<tildes>\\~+))"}${"((?<sizeString2>\\s*-?\\s*\\d[\\d\\s\\,]*)((?<dotDecimal2>\\.(?<decimal2>\\d+)?))?(?<prefix2>b|k|m|g|t)?)?"})?`),{defaultPrefix:a,caret:o,dollar:i,percent:l,sizeString1:c,decimal1:u,prefix1:d,exclamations:p,plus:f,minus:h,tildes:v,sizeString2:m,decimal2:y,prefix2:g}=(null==(s=t.match(n))?void 0:s.groups)||{};if(c){let t,n,multiplyByPrefix=function(e,t="b"){if(void 0===e)return;const n=["b","k","m","g","t"];return Math.trunc(e*1024**n.indexOf(t))};console.log({defaultPrefix:a,extra1:{caret:o,dollar:i,percent:l},sizeString1:c,decimal1:u,prefix1:d,exclamations:p,extra2:{plus:f,minus:h,tildes:v,sizeString2:m,decimal2:y,prefix2:g}});let s=Number(c.replaceAll(/[\s,]/g,""));const r=s.toString();let b=m&&Number(m.replaceAll(/[\s,]/g,""));const w=null==b?void 0:b.toString(),S=u?Number("0."+u):0,k=y?Number("0."+y):0;async function rangeSearch(a,s){const{_min:o,max:r}=a<s?{_min:a,max:s}:{_min:s,max:a},i=Math.max(0,o);t=`Size search from ${bytesToSizeWinLike(i)} to ${bytesToSizeWinLike(r)}`,n=await findAll(e,(e=>e.size>=i&&e.size<=r))}if(s=multiplyByPrefix(s+S,d||a),b=multiplyByPrefix(b+k,g||a),o)t=`Size search starts with "${r}"`,n=await findAll(e,(e=>e.size.toString().startsWith(r)));else if(i)t=`Size search ends with "${r}"`,n=await findAll(e,(e=>e.size.toString().endsWith(r)));else if(l)t=`Size search includes "${r}"`,n=await findAll(e,(e=>e.size.toString().includes(r)));else if(f&&w)await rangeSearch(s,s+b);else if(h&&w)await rangeSearch(s,b);else if(v)if(w)await rangeSearch(s-b,s+b);else{const e=v.length,t=Math.trunc(5*s*e/100);await rangeSearch(s-t,s+t)}else{const o=d||a;if(o&&"b"!==o){let e=r.length,t=multiplyByPrefix(1,o);1===e&&(t=Math.trunc(t/10));let n=s-t,a=s+t;p&&(n=s,p.length>1&&(a=s+Math.trunc(t/10))),await rangeSearch(n,a)}else t=`Size search ${bytesToSizeWinLike(s)}`,n=await findAll(e,(e=>e.size===s))}return console.log(...function(e){return[`%c${e}`,"color: #2196f3; font-weight: bold;"]}(t)),Object.defineProperty(n,"customSearchText",{value:t}),n}console.log("no size to search")}if(t.startsWith("/")){const{type:n,word:a}=(null==(o=t.match(/\/type:(?<type>[^\/]+)\/?(?<word>[^\/]*)/))?void 0:o.groups)||{};if(n&&(console.log({type:n,word:a}),Q.includes(n)))return findAll(e,(e=>e.type===n&&e.name.includes(a)))}else if(t.includes(" ")){const e=t.split(" ").filter((e=>e));if(e.length>1){let t,n=await justSearch(e.shift());for(;t=e.shift();)n=n.filter((e=>e.name.includes(t)));return n}}return justSearch(t);function justSearch(t){return findAll(e,(e=>e.name.includes(t)))}}(n,t);if(te.value=!1,ne.value=!1,!o)return;addMessage(`Search time: ${(performance.now()-a).toFixed(2)} ms; `),await sleep();const r=performance.now(),l=o.sort(comparator);appendMessage(`Sort time: ${(performance.now()-r).toFixed(2)} ms; `),await sleep(),console.time("search result size computing");const c=new Set(o),u=o.reduce(((e,t)=>computeEntrySize(t,c)+e),0),d=o.filter((e=>"folder"!==e.type)).reduce(((e,t)=>t.size+e),0);console.timeEnd("search result size computing"),console.log(u,d),setSearchResult(l);const p=o.customSearchText||t;appendMessage(`${o.length} items; size: ${bytesToSizeWinLike(d)} (${bytesToSizeWinLike(u)});  search: ${p}`)}function computeEntrySize(e,t){if("folder"!==e.type)return e.size;let n=0;for(const a of e.children||[])t.has(a)||("folder"===a.type?n+=computeEntrySize(a,t):n+=a.size);return n}async function findAll(e,t){let n=[],a=Date.now();for(const s of function*(e){const t=1e3;let n=[];function*takePart(e){for(const a of e.children||[])"folder"===a.type&&(yield*takePart(a)),n.push(a),n.length===t&&(yield n,n=[])}yield*takePart(e),yield n}(e)){const e=Date.now();e-a>15&&(a=e,await sleep());for(const a of s)t(a)&&n.push(a)}return n}async function*parseScan(e){const t=new EntryStreamParser;let n,a;if(e instanceof Response?n=e.headers.get("content-type"):e instanceof Blob&&(n=e.type),function(e){return Boolean(e.match(/^application\/.*?gzip/))}(n)){console.log("parseGZippedJSONScan");for await(const n of async function*(e){const t=new TextDecoder,n=new TextParser;let a=0,s=0;for await(const o of async function*(e){ie||await async function(){if(!ie){const e="https://cdn.jsdelivr.net/npm/pako@2.0.4/dist/pako_inflate.min.js",t="sha256-ZIKs3+RZEULSy0dR6c/mke8V9unZm9vuh05TqvtMdGU=";await function(e,t){return new Promise(((n,a)=>{const s=document.createElement("script");s.onload=n,s.onerror=n=>a({message:"Failed to load script",src:e,integrity:t,event:n}),s.src=e,s.async=!0,t&&(s.integrity=t,s.crossOrigin="anonymous"),document.body.append(s)}))}(e,t),ie=!0,console.log("pako is loaded")}}();let t=[];const n=new pako.Inflate;pako.Inflate.prototype.onData=function(e){t.push(e)};for await(const a of iterateAsyncDataSource(e)){n.push(a);for(const e of t)yield e;t=[]}yield n.result,n.err&&console.error(n.msg)}(e)){if(!(a++%20)){const e=Date.now();e-s>15&&(s=e,await sleep())}const e=t.decode(o,{stream:!0}),r=n.parsePart(e);r.length&&(yield r)}}(e))a||(a=n.shift(),t.setMeta(a)),yield{meta:a,...t.parse(n)}}else if(function(e){return Boolean(e.match(/^application\/.*?json/))}(n)){console.log("streamParseJSONScan");for await(const n of async function*(e){const t=new TextDecoder,n=new TextParser;let a=0,s=0;for await(const o of iterateAsyncDataSource(e)){if(!(a++%10)){const e=Date.now();e-s>15&&(s=e,await sleep())}const e=t.decode(o,{stream:!0}),r=n.parsePart(e);r.length&&(yield r)}}(e))a||(a=n.shift(),t.setMeta(a)),yield{meta:a,...t.parse(n)}}t.processHIDMapAsync()}o(ae,(async(e,t)=>{e?(ne.value=!0,e.length-t.length>1?await performSearch():await re()):setSearchResult([])}));class TextParser{constructor(){__publicField(this,"buffer",""),__publicField(this,"startHandled",!1),__publicField(this,"metaLines",[]),__publicField(this,"objects",[])}trimComma(e){return e.endsWith(",")?e.slice(0,-1):e}handleStart(e){if("["!==e)return""===e?(this.objects.push(this.metaLines.join("")),void(this.startHandled=!0)):void this.metaLines.push(e)}handleLine(e,t){t?this.buffer+=e:this.buffer?(this.objects.push(this.buffer+e),this.buffer=""):this.objects.push(e)}parsePart(e){const t=e.endsWith("\n]"),n=e.split("\n");for(let s=0;s<n.length;s++){const e=n[s],a=s===n.length-1;a&&t||(this.startHandled?this.handleLine(e,a):this.handleStart(e,a))}try{const e=JSON.parse(`[${this.trimComma(this.objects.join(""))}]`);return this.objects=[],e}catch(a){throw console.log(`[${this.trimComma(this.objects.join(""))}]`),console.log(this.objects),console.log(this,{isLastPart:t,textPart:e}),a}}}let ie=!1;const le=t(null),ce=t(null),ue=t(0);async function setScan(e){ee.value=!0;let t=!1,n=!1;console.time("setScan");let a=Date.now();for await(const{meta:s,root:o,rootUpdated:r}of parseScan(e)){!t&&s&&(le.value=l(s),t=!0),!n&&o&&(ce.value=l(o),globalThis.json=o,openFolder(o),n=!0);const e=Date.now();(r||e-a>50)&&(a=e,ue.value++,await sleep())}ue.value++,console.timeEnd("setScan"),ee.value=!1}const de=n((()=>{var e;return(null==(e=le.value)?void 0:e.separator)||"/"})),pe=n((()=>{var e;return(null==(e=le.value)?void 0:e.path)||[]})),fe=t(X),he=n((()=>fe.value.path));function openFolder(e){clearSearch(),fe.value=l(c(e)),G.value=50,globalThis.folder=e,console.log("globalThis.folder:",e)}const ve=n((()=>ce.value&&fe.value.isEmpty));o(le,(async(e,t)=>{console.log("[meta]:",le.value);const{files:n,folders:a,symlinks:s,errors:o,total:r,scanDate:i}=le.value;le.value.scanDate&&addMessage(`files: "${n}" folders: "${a}", symlinks: "${s}", errors: "${o}", total: "${r}", scanDate: "${dateToDayDateString(i)}"`)}));const me={class:"scanPath"},ye=["title"],ge={class:"part"},be={class:"part spaced"},we={key:0,class:"spaced separator"},Se={setup(e){const t=n((()=>{if(!le.value)return;const{files:e,folders:t,symlinks:n,charDevs:a,blockDevs:s,fifos:o,sockets:r,total:i,platform:l,scanDate:c}=le.value;function doString(e){return Object.entries(e).map((([e,t])=>function(e){const t=3-Math.trunc(e.length/4);return e+"\t".repeat(t)}(e)+": "+t)).join("\n")}const u=doString({files:e,folders:t,symlinks:n}),d=doString({charDevs:a,blockDevs:s,fifos:o,sockets:r}),p=doString({total:i,platform:l,scanDate:dateToDayDateString(c)});let f;return f="win32"!==l?[u,d,p].join("\n"):[u,p].join("\n"),console.log(f),f})),a=n((()=>{var e;const t=[...pe.value,fe.value.root.name].join(de.value);return t.startsWith("//")?t.slice(1):"win32"===(null==(e=le.value)?void 0:e.platform)?t[0].toUpperCase()+t.slice(1):t})),s=n((()=>[...a.value].slice(0,-1).join(""))),o=n((()=>[...a.value].slice(-1).join(""))),r=n((()=>he.value.length-1&&"/"!==a.value));function goToRoot(){const e=fe.value.root;debugMessageFromEntry(e),openFolder(e)}return(e,n)=>(u(),d("span",me,[p("span",{class:"parts",onClick:goToRoot,title:c(t)},[p("span",ge,f(c(s)),1),p("span",be,f(c(o)),1)],8,ye),c(r)?(u(),d("span",we,f(c(de)),1)):h("",!0)]))},__scopeId:"data-v-7487a6bd"};const ke={class:"opened-folder"},ze={class:"part"},De={class:"part spaced"},Te={key:0,class:"separator spaced"},xe={props:["index","count","entry"],setup(e){const t=e,{index:a,count:s,entry:o}=v(t),r=n((()=>a.value+1===s.value)),i=n((()=>[...o.value.name].slice(0,-1).join(""))),l=n((()=>[...o.value.name].slice(-1).join("")));function onClick(){debugMessageFromEntry(o.value),openFolder(o.value)}return(e,t)=>(u(),d("span",ke,[p("span",{class:"parts",onClick:onClick},[p("span",ze,f(c(i)),1),p("span",De,f(c(l)),1)]),c(r)?h("",!0):(u(),d("span",Te,f(c(de)),1))]))},__scopeId:"data-v-3c8242f7"};const Ee={class:"box"},Me={props:{maxWidth:{default:"max-content",type:String}},setup:e=>(t,n)=>(u(),d("div",Ee,[p("div",{class:"sub",style:y({maxWidth:e.maxWidth})},[m(t.$slots,"default",{},void 0,!0)],4)])),__scopeId:"data-v-f8be0ec4"};const _e={setup(e){async function onContextmenu(e){e.preventDefault();const t=[...le.value.path,...fe.value.path.map((e=>e.name))].join(de.value);console.log("Copy to clipboard:",t),await navigator.clipboard.writeText(t)}return(e,t)=>(u(),d("div",{class:"address",onContextmenu:onContextmenu},[g(Me,null,{default:b((()=>[g(Se)])),_:1}),(u(!0),d(w,null,S(c(he).slice(1),((e,t)=>(u(),k(Me,null,{default:b((()=>[g(xe,{entry:e,index:t,count:c(he).slice(1).length},null,8,["entry","index","count"])])),_:2},1024)))),256))],32))},__scopeId:"data-v-304c3618"};const je={class:"search-wrapper"},Ce={class:"search"},$e=(e=>(x("data-v-7cf12500"),e=e(),E(),e))((()=>p("label",{for:"json-scan-search-input",class:"fuck-off-lighthouse"},".",-1))),Ie={setup(e){const n=t();function onClearClick(){clearSearch(),n.value.focus()}return(e,t)=>(u(),d("div",je,[p("div",Ce,[z(p("input",{id:"json-scan-search-input",type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>T(ae)?ae.value=e:null),ref_key:"inputRef",ref:n},null,512),[[D,c(ae)]]),p("button",{onClick:onClearClick},"Clear")]),$e]))},__scopeId:"data-v-7cf12500"};class FileEntry{constructor({file:e,parent:t,type:n,name:a}){e&&(this.file=e),t&&(this.parent=t,t.addChild(this)),a&&(this._name=a),this.type=n}get name(){var e;return this._name||(null==(e=this.file)?void 0:e.name)}addChild(e){this.children||(this.children=[]),this.children.push(e),this.increaseContentSize(e.size)}increaseContentSize(e){e&&(this._contentSize||(this._contentSize=0),this._contentSize+=e,this.parent&&this.parent.increaseContentSize(e))}get size(){var e;return"folder"===this.type?this._contentSize||0:(null==(e=this.file)?void 0:e.size)||0}get mtime(){var e;return(null==(e=this.file)?void 0:e.lastModified)||0}get path(){return this.parent?[...this.parent.path,this]:[this]}*[Symbol.iterator](){if(yield this,this.children)for(const e of this.children)yield*e}flat(){return[...this]}static flat(e){return e.map((e=>[...e])).flat()}static async fromDataTransferItems(e){const t=await async function(e){const t=[];for(const n of e)t.push(await dtItemToFileSystemEntry(n));return t}(e);console.log("[fileSystemEntries]:",t);const n=[];for(const a of t)n.push(await fromFileSystemEntry(a));return n}static fromFiles(e){const t=[];for(const n of e)t.push(new FileEntry({file:n,type:"file"}));return t}}async function fromFileSystemEntry(e,t=null){if(e.isFile)try{const a=await(n=e,new Promise(((e,t)=>n.file(e,t))));return new FileEntry({file:a,type:"file",parent:t})}catch(a){return console.error("[fromFileSystemEntry][error]",e.name,a),null}else if(e.isDirectory){const n=new FileEntry({type:"folder",parent:t,name:e.name}),a=async function*(e){const t=e.createReader();let n=[];do{n=await new Promise(((e,n)=>t.readEntries(e,n)));for(const e of n)yield e}while(n.length)}(e);for await(const e of a)await fromFileSystemEntry(e,n);return n}var n}async function dtItemToFileSystemEntry(e){return e.webkitGetAsEntry()}const Pe=t([]),Fe=t([]),Le=t(!1),Be=t(0),Re=t([]),We=t([]),Ae=t(!1);r((async()=>{const e=Date.now();Ae.value=!0,Fe.value.length?We.value=await FileEntry.fromDataTransferItems(Fe.value):We.value=FileEntry.fromFiles(Pe.value),Ae.value=!1,console.log("[FileEntry parsing][time]:",Date.now()-e,"ms"),console.log("[fileEntries]",s(We.value))}));const Oe=n((()=>We.value[0])),Ne=n((()=>We.value.length));function setDataTransfer(e){console.log(e),setFiles(e.files),function(e){const t=[...e];Fe.value=t,console.log("[setDtItems]:",t),console.log(t[0].kind),console.log(t[0].type)}(e.items)}function setFiles(e){const t=[...e];Pe.value=t,console.log("[setFiles]:",t)}const Ue={class:"default-hover-text"},He={setup(e){const t=n((()=>{const e=Be.value>1?"s":"";return`Drop ${Be.value} file${e}`}));return(e,n)=>(u(),d("div",Ue,f(c(t)),1))},__scopeId:"data-v-6f26b9b7"};const Ze=["title"],Ge={key:0,class:"parsing"},Je={key:1},Ke={key:2,style:{display:"contents"}},qe=M("Select file"),Ye={setup(e){const t=n((()=>We.value.slice(0,50).map((e=>e.name)).join("\n")));return(e,n)=>(u(),d("div",{class:"default-prompt-text",title:c(t)},[c(Ae)?(u(),d("div",Ge,"Parsing...")):c(Ne)?(u(),d("div",Je,f(c(Ne))+" file"+f(c(Ne)>1?"s":""),1)):(u(),d("div",Ke,[m(e.$slots,"default",{},(()=>[qe]),!0)]))],8,Ze))},__scopeId:"data-v-14bc35f2"};const Ve={key:0,class:"content hover"},Qe={key:1,class:"content selected"},Xe={key:2,class:"content prompt"},et={props:{globalDropZone:{type:Boolean,default:!0}},setup(e){const a=e,{globalDropZone:s}=v(a);function onFileInputChange(e){setFiles(e.target.files),Fe.value=[]}const o=t(null),r=n((()=>s.value?document.body:o.value));function stopEvent(e){e.preventDefault(),e.stopPropagation()}function onDrop(e){stopEvent(e),Le.value=!1,setDataTransfer(e.dataTransfer)}function onDragOver(e){stopEvent(e),e.dataTransfer.dropEffect="copy"}function onDragEnter(e){stopEvent(e),Le.value||(Le.value=!0,function(e){const t=e.items.length,n=[...e.items].map((e=>e.type)),a=[...new Set(n)];Be.value=t,Re.value=a,console.log("[setDataTransferHover]:",t,a)}(e.dataTransfer))}function onDragLeave(e){stopEvent(e),r.value.contains(e.relatedTarget)||(Le.value=!1,Be.value=0,Re.value=[])}return _((()=>{s.value||function(){const dragOverCallback=e=>{r.value.contains(e.target)||(stopEvent(e),e.dataTransfer.dropEffect="none")};document.body.addEventListener("dragover",dragOverCallback)}(),r.value.addEventListener("drop",onDrop),r.value.addEventListener("dragover",onDragOver),r.value.addEventListener("dragleave",onDragLeave),r.value.addEventListener("dragenter",onDragEnter)})),(e,t)=>(u(),d("div",{class:j(["file-input",{"drop-hover":c(Le)}]),ref_key:"fileInputElem",ref:o},[p("label",null,[p("input",{type:"file",accept:"*/*",multiple:"",onChange:onFileInputChange,style:{display:"none"}},null,32),c(Le)?(u(),d("span",Ve,[m(e.$slots,"hover",{},(()=>[g(He)]),!0)])):c(Oe)&&!c(Ae)?(u(),d("span",Qe,[m(e.$slots,"selected",{},(()=>[g(Ye)]),!0)])):(u(),d("span",Xe,[m(e.$slots,"prompt",{},(()=>[g(Ye)]),!0)]))]),(u(),k(C,{to:"body"},[p("div",{class:j(["file-input-hover-modal",{"drop-hover":c(Le)}])},null,2)]))],2))},__scopeId:"data-v-4d2f2087"};const tt={class:"file-input-wrapper"},nt={setup:e=>(r((()=>{Oe.value&&(clearSearch(),setScan(Oe.value.file))})),(e,t)=>(u(),d("div",tt,[g(et)]))),__scopeId:"data-v-89ad98b6"};const at={class:"tabs"},st=(e=>(x("data-v-4cf83322"),e=e(),E(),e))((()=>p("div",{class:"tab"},null,-1))),ot={setup:e=>(e,t)=>(u(),d("div",at,[g(nt,{class:"tab"}),st])),__scopeId:"data-v-4cf83322"};const rt=["title"],it={class:"icon"},lt={class:"name"},ct={class:"mtime"},ut={props:["entry"],setup(e){const t=e,a=n((()=>(ue.value,o.value.hasErrors?"":bytesToSizeWinLike(o.value.size)))),s=n((()=>"0 B"===a.value?"Z":a.value.split(" ")[1])),o=v(t).entry,r=n((()=>o.value.hasErrors)),i=n((()=>{if(void 0===o.value.mtime)return"";return dateToDayDateTimeString(o.value.mtime,!1).slice(0,-3)})),l=n((()=>o.value.hasErrors?JSON.stringify(o.value.errors[0],null," "):"symlink"===o.value.type?o.value.pathTo:void 0)),h=n((()=>"folder"===o.value.type?"üìÅ":"file"===o.value.type?function(e){const{ext:t}=e.match(/(?<ext>[^.]+)$/).groups;return R.includes(t)}(o.value.name)?"üé¶":function(e){const{ext:t}=e.match(/(?<ext>[^.]+)$/).groups;return W.includes(t)}(o.value.name)?"üñº":"üìÑ":"symlink"===o.value.type?"üîó":"üëæ"));function onClick(e){debugMessageFromEntry(o.value),"folder"===o.value.type&&openFolder(o.value)}function onMousedown(e){1===e.button&&(e.preventDefault(),console.log(o.value,[...le.value.path,...o.value.path.map((e=>e.name))].join(de.value).replace("//","/")),fe.value!==o.value.parent&&openFolder(o.value.parent))}function onMouseover(e){Y.value=o.value}function onMouseleave(e){Y.value=null}return(e,t)=>(u(),d("tr",{class:j(["row",{error:c(r)}]),onClick:onClick,onMousedown:onMousedown,onMouseover:onMouseover,onMouseleave:onMouseleave,title:c(l)},[p("td",it,f(c(h)),1),p("td",lt,f(c(o).name),1),p("td",{class:j(["size",c(s)])},f(c(a)),3),p("td",ct,f(c(i)),1)],42,rt))},__scopeId:"data-v-f71509d6"};const dt={setup(e){const n=new IntersectionObserver((e=>{const[t]=e;t.isIntersecting&&q.value>G.value&&(G.value=G.value+50)})),a=t(null);return _((()=>{n.observe(a.value)})),$((()=>{n.disconnect()})),(e,t)=>(u(),d("div",{class:"intersection",ref_key:"intersection",ref:a},null,512))},__scopeId:"data-v-5baedc86"};const _withScopeId=e=>(x("data-v-d2171e22"),e=e(),E(),e),pt={key:0,class:"rows"},ft={key:1,class:"empty-message"},ht=[_withScopeId((()=>p("span",null,"The folder is empty.",-1)))],vt={key:2,class:"error-message"},mt=_withScopeId((()=>p("h2",null,"Error",-1))),yt=_withScopeId((()=>p("td",null,"syscall",-1))),gt=_withScopeId((()=>p("td",null,"code",-1))),bt=_withScopeId((()=>p("td",null,"errno",-1))),wt={setup(e){I((e=>({"78b3c76e":s.value})));const a=n((()=>!!fe.value.hasErrors&&fe.value.errors[0]));function onContextMenu(e){e.preventDefault(),fe.value.parent&&openFolder(fe.value.parent)}const s=t("880px");return _((()=>{const e=document.body.offsetWidth;if(e<1280){let t=880-(1280-e);t=t<140?140:t,s.value=`${t}px`}})),(e,t)=>(u(),d("div",{class:"content",onContextmenu:onContextMenu},[c(K).length?(u(),d("table",pt,[p("tbody",null,[(u(!0),d(w,null,S(c(K),(e=>(u(),k(ut,{entry:e},null,8,["entry"])))),256)),g(dt)])])):h("",!0),c(ve)&&!c(a)?(u(),d("div",ft,ht)):h("",!0),c(a)?(u(),d("div",vt,[p("div",null,[mt,p("table",null,[p("tr",null,[yt,p("td",null,[p("pre",null,f(c(a).syscall),1)])]),p("tr",null,[gt,p("td",null,[p("pre",null,f(c(a).code),1)])]),p("tr",null,[bt,p("td",null,[p("pre",null,f(c(a).errno),1)])])])])])):h("",!0)],32))},__scopeId:"data-v-d2171e22"};const St={class:"status"},kt={setup(e){const t=n((()=>{var e;return(null==(e=Y.value)?void 0:e.size)&&bytesToSizeWinLike(Y.value.size)}));return(e,n)=>(u(),d("div",St,[p("span",null,"Items count: "+f(c(q)),1),z(p("span",null,". Hover item's size: "+f(c(t)),513),[[P,c(Y)]])]))},__scopeId:"data-v-08ca63fc"};const zt={class:"switch"},Dt={setup(e){function onClick(e){O.value===e&&(N.value[O.value]=!N.value[O.value]),O.value=e}return(e,t)=>(u(),d("div",zt,[p("button",{class:j(["order-by-name",{active:"name"===c(O)}]),title:"Order by name",onClick:t[0]||(t[0]=e=>onClick("name"))},f(c(N).name?"N":"n"),3),p("button",{class:j(["order-by-size",{active:"size"===c(O)}]),title:"Order by size",onClick:t[1]||(t[1]=e=>onClick("size"))},f(c(N).size?"S":"s"),3),p("button",{class:j(["order-by-date",{active:"mtime"===c(O)}]),title:"Order by date",onClick:t[2]||(t[2]=e=>onClick("mtime"))},f(c(N).mtime?"D":"d"),3)]))},__scopeId:"data-v-68f2d0ba"};const Tt={class:"debug"},xt={key:0},Et={key:1},Mt={setup:e=>(e,t)=>(u(),d("div",Tt,[c(V)?(u(),d("span",xt,f(c(V)),1)):(u(),d("span",Et,"_"))])),__scopeId:"data-v-16910406"};const _t={},jt={class:"guide"},Ct=[F('<div class="text-wrapper" data-v-e2e7dfd4><h2 data-v-e2e7dfd4>No scan selected</h2><div data-v-e2e7dfd4>Use your own directory scan file (created with <a href="https://github.com/AlttiRi/directory-snapshot-explorer#how-to-use" target="_blank" data-v-e2e7dfd4>the scanner</a>). </div><div class="" data-v-e2e7dfd4>Or use the demo scans to take a look at the program work: <ul data-v-e2e7dfd4><li data-v-e2e7dfd4><a href="./?filepath=https://alttiri.github.io/json-flat-scans/windows-admin.json.gz" data-v-e2e7dfd4>Win 10 scan (as Admin)</a></li><li data-v-e2e7dfd4><a href="./?filepath=https://alttiri.github.io/json-flat-scans/ubuntu-admin.json.gz" data-v-e2e7dfd4>Ubuntu scan (as Root)</a></li><li data-v-e2e7dfd4><a href="./?filepath=https://alttiri.github.io/json-flat-scans/linux-master.json.gz" data-v-e2e7dfd4>Linux Source Code scan</a></li></ul></div><div data-v-e2e7dfd4>For more info see the <a href="https://github.com/AlttiRi/directory-snapshot-explorer#directory-snapshot-explorer" target="_blank" data-v-e2e7dfd4>Readme</a>.</div></div>',1)];_t.render=function(e,t){return u(),d("div",jt,Ct)},_t.__scopeId="data-v-e2e7dfd4";const $t={},It={class:"inner-modal"};$t.render=function(e,t){return u(),d("div",It,[m(e.$slots,"default",{},void 0,!0)])},$t.__scopeId="data-v-462d7e6d";const Pt={class:"main"},Ft=M(" [Search]: Scan parsing awaiting "),Lt={setup(e){globalThis.bytesToSize=bytesToSize,globalThis.bytesToSizeWinLike=bytesToSizeWinLike;const t=n((()=>!le.value&&!new URL(location.href).searchParams.get("filepath")));return _((async()=>{const e=new URL(location.href),t=e.searchParams.get("filepath");if(t){const e=await fetch(t);await setScan(e)}const n=e.searchParams.get("search");n&&(ae.value=n)})),(e,n)=>(u(),d("div",Pt,[g(Dt,{style:{"grid-area":"switch"}}),g(_e,{style:{"grid-area":"address"}}),g(Ie,{style:{"grid-area":"search"}}),g(ot,{style:{"grid-area":"tabs"}}),c(t)?(u(),k(_t,{key:0,style:{"grid-area":"content"}})):c(ee)&&c(ne)?(u(),k($t,{key:1,style:{"grid-area":"content"}},{default:b((()=>[Ft])),_:1})):(u(),k(wt,{key:2,style:{"grid-area":"content"}})),g(kt,{style:{"grid-area":"status"}}),g(Mt,{style:{"grid-area":"debug"}})]))},__scopeId:"data-v-0440debe"};L({setup:e=>(e,t)=>(u(),k(Lt))}).mount("#app");
//# sourceMappingURL=index.js.map
