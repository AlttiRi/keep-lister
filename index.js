import{r as e,c as t,w as n,m as s,i as o,t as r,u as a,p as l,a as c,o as i,b as u,d,e as f,f as p,g as v,h,n as m,j as y,k as g,F as k,l as w,q as b,s as D,v as _,x,y as j,z as T,A as E,B as $}from"./vendor.js";const C=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver((e=>{for(const t of e){if("childList"!==t.type)continue;for(const e of t.addedNodes)if("LINK"===e.tagName&&"modulepreload"===e.rel)n(e)}})).observe(document,{childList:true,subtree:true});function t(e){const t={};if(e.integrity)t.integrity=e.integrity;if(e.referrerpolicy)t.referrerPolicy=e.referrerpolicy;if("use-credentials"===e.crossorigin)t.credentials="include";else if("anonymous"===e.crossorigin)t.credentials="omit";else t.credentials="same-origin";return t}function n(e){if(e.ep)return;e.ep=true;const n=t(e);fetch(e.href,n)}};C();const I=globalThis.setImmediate||function(){const{port1:e,port2:t}=new MessageChannel;const n=[];e.onmessage=function(){const e=n.shift();e()};return function(e){t.postMessage(null);n.push(e)}}();function S(e){if(void 0===e)return new Promise((e=>I(e)));return new Promise((t=>setTimeout(t,e)))}const M=["mp4","webm","mkv","avi"];function N(e){const{ext:t}=e.match(/(?<ext>[^\.]+)$/).groups;return M.includes(t)}const L=["png","jpg","jpeg","gif","tiff","webp"];function O(e){const{ext:t}=e.match(/(?<ext>[^\.]+)$/).groups;return L.includes(t)}function P(e,t=50){let n;return function(){if(n)clearTimeout(n);n=setTimeout((()=>{e.apply(this,arguments);n=null}),t)}}function F(e,t=true){const n=new Date(e);function s(e){return e.toString().padStart(2,"0")}const o=t?"UTC":"";const r=n[`get${o}FullYear`]();const a=n[`get${o}Month`]()+1;const l=n[`get${o}Date`]();if(0===Number(n)){console.warn("date is 1970.01.01");return""}return r+"."+s(a)+"."+s(l)}const W=e(true);const{compare:B}=new Intl.Collator(void 0,{numeric:true,sensitivity:"accent"});function U(e,t){if(W.value)return B(e.name,t.name);return 0}const q=t((()=>be.value.folders));const A=t((()=>be.value.files));const J=t((()=>be.value.symlinks));const z=t((()=>be.value.fifos));const K=t((()=>be.value.charDevs));const R=t((()=>be.value.blockDevs));const V=t((()=>be.value.sockets));const Y=t((()=>[...q.value.sort(U),...A.value.sort(U),...J.value.sort(U),...z.value.sort(U),...K.value.sort(U),...R.value.sort(U),...V.value.sort(U)]));const G=1e3;const H=t((()=>{if(ae.value.length)return ce.value;return Y.value}));const Q=t((()=>H.value.slice(0,G)));const X=t((()=>{if(ce.value.length>G)return ce.value.length;return H.value.length}));const Z=e("");function ee(e){Z.value=e}function te(e){Z.value+=e}const ne=["folder","file","symlink","fifo","charDev","blockDev","socket"];class se{constructor({name:e,parent:t,type:n,meta:s,errors:o}){this.name=e;this.parent=t;this.type=n;if(s)this.meta=s;if(o)this.errors=o}addChild(e){if(!this.children)this.children=[];this.children.push(e)}get folders(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"folder"===e.type)))||[]}get files(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"file"===e.type)))||[]}get symlinks(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"symlink"===e.type)))||[]}get fifos(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"fifo"===e.type)))||[]}get charDevs(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"charDev"===e.type)))||[]}get blockDevs(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"blockDev"===e.type)))||[]}get sockets(){var e;return(null==(e=this.children)?void 0:e.filter((e=>"socket"===e.type)))||[]}get isEmpty(){var e;return!Boolean(null==(e=this.children)?void 0:e.length)}get hasErrors(){var e;return Boolean(null==(e=this.errors)?void 0:e.length)}get root(){if(!this.parent)return this;return this.parent.root}get path(){if(!this.parent)return[this];return[...this.parent.path,this]}}function oe(e,t=null){const n=new se({name:e.name,type:"folder",errors:e.errors,parent:t});if(e.folders)e.folders.forEach((e=>{n.addChild(oe(e,n))}));const s=["file","fifo","charDev","blockDev","socket"];s.forEach((t=>{if(e[t+"s"])e[t+"s"].forEach((e=>{n.addChild(new se({name:e,parent:n,type:t}))}))}));if(e.symlinks)e.symlinks.forEach((e=>{if("string"===typeof e){n.addChild(new se({name:e,parent:n,type:"symlink"}));return}const t=e.pathTo?{pathTo:e.pathTo}:null;n.addChild(new se({name:e.name,parent:n,type:"symlink",meta:t,errors:e.errors}))}));return n}const re=new se({name:"",parent:null,type:"folder"});const ae=e("");function le(){ae.value=""}const ce=e([]);function ie(){ue([])}function ue(e){ce.value=s(e);console.log("globalThis.search:",globalThis.search=e);Object.defineProperty(globalThis.search,"download",{get(){console.log("download")}})}const de=P(fe,300);async function fe(){const e=be.value;const t=ae.value;const n=o(e)?r(e):e;const s=performance.now();const a=await pe(n,t);if(!a)return;const l=performance.now()-s;ee(`Search time: ${l.toFixed(2)} ms; `);await S();const c=performance.now();const i=a.sort(U);const u=performance.now()-c;te(`Sort time: ${u.toFixed(2)} ms; `);await S();ue(i);te(`${a.length} items; search: ${t}`)}async function pe(e,t){var n;if(t.startsWith("/")){const{type:s,word:o}=(null==(n=t.match(/\/type:(?<type>[^\/]+)\/?(?<word>[^\/]*)/))?void 0:n.groups)||{};if(s){console.log({type:s,word:o});if(ne.includes(s))return ve(e,(e=>e.type===s&&e.name.includes(o)))}}else return ve(e,(e=>e.name.includes(t)));return false}n(ae,(async(e,t)=>{const n=!e;if(n){ie();return}if(e.length-t.length>1)await fe();else await de()}));async function ve(e,t){let n=[];let s=Date.now();for(const o of he(e)){const e=Date.now();if(e-s>15){s=e;await S()}for(const s of o)if(t(s))n.push(s)}return n}function*he(e){const t=1e3;let n=[];function*s(e){for(const o of e.children||[]){if("folder"===o.type)yield*s(o);n.push(o);if(n.length===t){yield n;n=[]}}}yield*s(e);yield n}const me=e(null);const ye=e(null);function ge(e){me.value=s(e.meta);console.time("parseEntries");const t=oe(e);console.timeEnd("parseEntries");ye.value=s(t);globalThis.json=t;_e(t);le()}const ke=t((()=>{var e;return(null==(e=me.value)?void 0:e.separator)||"/"}));const we=t((()=>{var e;return(null==(e=me.value)?void 0:e.path)||[]}));const be=e(re);const De=t((()=>be.value.path));function _e(e){le();be.value=s(a(e))}function xe(){if(be.value.parent)_e(be.value.parent)}const je=t((()=>ye.value&&be.value.isEmpty));n(me,(async(e,t)=>{console.log("[meta]:",me.value);const{files:n,folders:s,symlinks:o,errors:r,total:a,scanDate:l}=me.value;if(me.value.scanDate)ee(`files: "${n}" folders: "${s}", symlinks: "${o}", errors: "${r}", total: "${a}", scanDate: "${F(l)}"`)}));l("data-v-06f0cfae");const Te={class:"scanPath"};const Ee=["title"];const $e={class:"part"};const Ce={class:"part spaced"};const Ie={key:0,class:"spaced separator"};c();const Se={setup(e){const n=t((()=>{if(!me.value)return;const{files:e,folders:t,symlinks:n,charDevs:s,blockDevs:o,fifos:r,sockets:a,total:l,platform:c,scanDate:i}=me.value;function u(e){function t(e){const t=3-Math.trunc(e.length/4);console.log(e,t);return e+"\t".repeat(t)}return Object.entries(e).map((([e,n])=>t(e)+": "+n)).join("\n")}const d=u({files:e,folders:t,symlinks:n});const f=u({charDevs:s,blockDevs:o,fifos:r,sockets:a});const p=u({total:l,platform:c,scanDate:F(i)});let v;if("win32"!==c)v=[d,f,p].join("\n");else v=[d,p].join("\n");console.log(v);return v}));const s=t((()=>{const e=[...we.value,be.value.root.name];const t=e.join(ke.value);if(t.startsWith("//"))return t.slice(1);return t}));const o=t((()=>[...s.value].slice(0,-1).join("")));const r=t((()=>[...s.value].slice(-1).join("")));const l=t((()=>De.value.length-1&&"/"!==s.value));function c(){_e(be.value.root)}return(e,t)=>(i(),u("span",Te,[d("span",{class:"parts",onClick:c,title:a(n)},[d("span",$e,f(a(o)),1),d("span",Ce,f(a(r)),1)],8,Ee),a(l)?(i(),u("span",Ie,f(a(ke)),1)):p("",true)]))}};Se.__scopeId="data-v-06f0cfae";l("data-v-44b3de2e");const Me={class:"opened-folder"};const Ne={class:"part"};const Le={class:"part spaced"};const Oe={key:0,class:"separator spaced"};c();const Pe={props:["index","count","entry"],setup(e){const n=e;const{index:s,count:o,entry:r}=v(n);const l=t((()=>s.value+1===o.value));const c=t((()=>[...r.value.name].slice(0,-1).join("")));const h=t((()=>[...r.value.name].slice(-1).join("")));function m(){_e(r.value)}return(e,t)=>(i(),u("span",Me,[d("span",{class:"parts",onClick:m},[d("span",Ne,f(a(c)),1),d("span",Le,f(a(h)),1)]),!a(l)?(i(),u("span",Oe,f(a(ke)),1)):p("",true)]))}};Pe.__scopeId="data-v-44b3de2e";l("data-v-f8be0ec4");const Fe={class:"box"};c();const We={props:{maxWidth:{default:"max-content",type:String}},setup(e){return(t,n)=>(i(),u("div",Fe,[d("div",{class:"sub",style:m({maxWidth:e.maxWidth})},[h(t.$slots,"default",{},void 0,true)],4)]))}};We.__scopeId="data-v-f8be0ec4";l("data-v-55c28eea");const Be={class:"address"};c();const Ue={setup(e){return(e,t)=>(i(),u("div",Be,[y(We,null,{default:g((()=>[y(Se)])),_:1}),(i(true),u(k,null,w(a(De).slice(1),((e,t)=>(i(),b(We,null,{default:g((()=>[y(Pe,{entry:e,index:t,count:a(De).slice(1).length},null,8,["entry","index","count"])])),_:2},1024)))),256))]))}};Ue.__scopeId="data-v-55c28eea";l("data-v-4c326e10");const qe={class:"search"};c();const Ae={setup(e){return(e,t)=>(i(),u("div",qe,[D(d("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>x(ae)?ae.value=e:null)},null,512),[[_,a(ae)]]),d("button",{onClick:t[1]||(t[1]=(...e)=>a(le)&&a(le)(...e))},"Clear")]))}};Ae.__scopeId="data-v-4c326e10";l("data-v-31779169");const Je={class:"file-select"};const ze=j(" Select file ");const Ke=d("hr",null,null,-1);c();const Re={setup(e){async function t(e){const t=JSON.parse(await e.target.files[0].text());ge(t)}return(e,n)=>(i(),u("div",Je,[d("label",null,[ze,d("input",{type:"file",accept:"application/json",onChange:t},null,32)]),Ke]))}};Re.__scopeId="data-v-31779169";l("data-v-1717d4e8");const Ve={class:"tabs"};const Ye=d("div",{class:"tab"},"Tab 1",-1);c();const Ge={setup(e){return(e,t)=>(i(),u("div",Ve,[y(Re,{class:"tab"}),Ye]))}};Ge.__scopeId="data-v-1717d4e8";l("data-v-33217ece");const He=["title"];const Qe={class:"icon"};const Xe={class:"name"};c();const Ze={props:["entry"],setup(e){const n=e;const s=v(n).entry;const o=t((()=>s.value.hasErrors));const r=t((()=>{var e;if(s.value.hasErrors)return JSON.stringify(s.value.errors[0],null," ");if("symlink"===s.value.type)return null==(e=s.value.meta)?void 0:e.pathTo}));const l=t((()=>{if("folder"===s.value.type)return"ðŸ“";else if("file"===s.value.type){if(N(s.value.name))return"ðŸŽ¦";else if(O(s.value.name))return"ðŸ–¼";return"ðŸ“„"}else if("symlink"===s.value.type)return"ðŸ”—";return"ðŸ‘¾"}));function c(e){if("folder"===s.value.type){console.log("openFolder",s.value);_e(s.value)}else console.log(s.value)}function p(e){const t=2;if(e.which===t&&"folder"===s.value.type)console.log("MIDDLE_BUTTON on a folder")}return(e,t)=>(i(),u("tr",{class:T(["row",{error:a(o)}]),onClick:c,onMousedown:p,title:a(r)},[d("td",Qe,f(a(l)),1),d("td",Xe,f(a(s).name),1)],42,He))}};Ze.__scopeId="data-v-33217ece";l("data-v-47520d98");const et={key:0,class:"rows"};const tt={key:1,class:"empty-message"};const nt=d("span",null,"The folder is empty.",-1);const st=[nt];const ot={key:2,class:"error-message"};const rt=d("h2",null,"Error",-1);const at=d("td",null,"syscall",-1);const lt=d("td",null,"code",-1);const ct=d("td",null,"errno",-1);c();const it={setup(e){const n=t((()=>{if(be.value.hasErrors)return be.value.errors[0];return false}));function s(e){e.preventDefault();xe()}return(e,t)=>(i(),u("div",{class:"content",onContextmenu:s},[a(Q).length?(i(),u("table",et,[(i(true),u(k,null,w(a(Q),(e=>(i(),b(Ze,{entry:e},null,8,["entry"])))),256))])):p("",true),a(je)&&!a(n)?(i(),u("div",tt,st)):p("",true),a(n)?(i(),u("div",ot,[d("div",null,[rt,d("table",null,[d("tr",null,[at,d("td",null,[d("pre",null,f(a(n).syscall),1)])]),d("tr",null,[lt,d("td",null,[d("pre",null,f(a(n).code),1)])]),d("tr",null,[ct,d("td",null,[d("pre",null,f(a(n).errno),1)])])])])])):p("",true)],32))}};it.__scopeId="data-v-47520d98";const ut={setup(e){return(e,t)=>(i(),u("div",null,"Item count: "+f(a(X)),1))}};const dt={key:0};const ft={key:1};const pt={setup(e){return(e,t)=>a(Z)?(i(),u("span",dt,f(a(Z)),1)):(i(),u("span",ft,"_"))}};l("data-v-607dbe3e");const vt={class:"main"};const ht=d("div",{style:{"grid-area":"switch"}},null,-1);c();const mt={setup(e){E((async()=>{const e=new URL(location.href).searchParams.get("filepath");if(e){const t=await fetch(e);const n=await t.json();ge(n)}}));return(e,t)=>(i(),u("div",vt,[ht,y(Ue,{style:{"grid-area":"address"}}),y(Ae,{style:{"grid-area":"search"}}),y(Ge,{style:{"grid-area":"tabs"}}),y(it,{style:{"grid-area":"content"}}),y(ut,{style:{"grid-area":"status"}}),y(pt,{style:{"grid-area":"debug"}})]))}};mt.__scopeId="data-v-607dbe3e";const yt={setup(e){return(e,t)=>(i(),b(mt))}};$(yt).mount("#app");
//# sourceMappingURL=index.js.map
